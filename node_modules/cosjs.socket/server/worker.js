"use strict";
const cosjs_socket  = require('../library/socket');
const cosjs_manager = require('../library/manager');

exports = module.exports = function(opts){
    if(!opts.name){
        throw new Error('cosjs.socket worker opts.model empty ');
    }
    if(!this.manager){
        throw new Error('cosjs.socket start '+opts.name+' but manager opts empty ');
    }
    opts.key = opts.key ? opts.key : [opts.host,opts.port].join(':');
    var root =  [this.root, opts.name].join('/');
    var application = cosjs_socket(root,opts);
    //连接MASTER
    var manager = cosjs_manager(this.manager);
    application.defineHandlePrototype('manager',manager);
    
    setInterval(function(){ manager.emit(opts.name,opts);  },opts.refresh || 1000);
    return application;
}