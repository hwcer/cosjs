var crypto = require('crypto');
var ObjectID = require('./ObjectID');

var algorithm = 'aes-128-cfb';
const library = require('cosjs.library');
//加密
exports.encode = function(str,secret){

    var rndstr = library('random').roll(1000,9999).toString();
    var newstr = rndstr + str;
    var cipher  = crypto.createCipher(algorithm,secret);
    var enc  = cipher .update(newstr, "utf8", "hex");
    enc += cipher.final("hex");
    return enc;
}

//解密
exports.decode = function(str, secret){
    try {
        var decipher = crypto.createDecipher(algorithm,secret);
        var dec = decipher.update(str, "hex", "utf8");
        dec += decipher.final("utf8");
        var code = dec.substr(4);
    }
    catch (e){
        var code = '';
    }
    return code;
}

exports.ObjectID = function(){
    return ObjectID().toString();
}
