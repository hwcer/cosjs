var crypto = require('crypto');
var ObjectID = require('./ObjectID');

var rndlen = 4;
var algorithm = 'aes-128-cfb';

//加密
exports.encode = function(str,secret){
    var rndstr = md5(Math.random()).substr(0,rndlen);
    var newstr = rndstr + str;
    var cipher  = crypto.createCipher(algorithm,secret);
    var enc  = cipher .update(newstr, "utf8", "hex");
    enc += cipher .final("hex");
    return enc;
}

//解密
exports.decode = function(str, secret){
    try {
        var decipher = crypto.createDecipher(algorithm, secret);
        var dec = decipher.update(str, "hex", "utf8");
        dec += decipher.final("utf8");
        var code = dec.substr(rndlen);
    }
    catch (e){
        var code = '';
    }
    return code;
}

exports.ObjectID = function(){
    return ObjectID().toString();
}

function md5(str){
    var cipher = crypto.createHash('md5');
    cipher.update(str.toString(),'utf8');
    return cipher.digest('hex');
}

